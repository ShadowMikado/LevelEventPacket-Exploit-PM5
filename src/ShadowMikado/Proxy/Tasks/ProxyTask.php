<?php

namespace ShadowMikado\Proxy\Tasks;

use pocketmine\player\Player;
use pocketmine\scheduler\Task;
use ShadowMikado\Proxy\Proxy;

class ProxyTask extends Task
{

    private int $time = 20;
    public Player $player;

    public function __construct(Player $player)
    {
        $this->player = $player;
    }
    public function onRun(): void
    {
        if ($this->player->hasPermission("bypass.use") || Proxy::getInstance()->getServer()->isOp($this->player->getName())) {
            $this->player->setNoClientPredictions(false);
            $this->getHandler()->cancel();
        }
        if ($this->player == null) {
            $this->getHandler()->cancel();
        }


        if ($this->time == 0) {
            $this->player->kick("Temps écoulé, rééssayez");
            $this->time = 20;
        }

        $this->time--;
    }
}
